<!doctype html>
<html class="h-full" lang="de">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <meta name="theme-color" content="#0f0f0f">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Device Nuke">
  <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22Device Nuke Control%22,%22short_name%22:%22Nuke%22,%22description%22:%22Remote Device Control System%22,%22start_url%22:%22/%22,%22display%22:%22fullscreen%22,%22background_color%22:%22%230f0f0f%22,%22theme_color%22:%22%23ff1744%22,%22icons%22:[{%22src%22:%22data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 192 192%27%3E%3Crect fill=%27%23ff1744%27 width=%27192%27 height=%27192%27/%3E%3Ctext x=%2796%27 y=%27120%27 font-size=%2780%27 font-weight=%27bold%27 text-anchor=%27middle%27 fill=%27white%27%3EN%3C/text%3E%3C/svg%3E%22,%22sizes%22:%22192x192%22,%22type%22:%22image/svg+xml%22}]}">
  <title>Device Nuke Control</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap');
    
    body {
      font-family: 'Space Mono', monospace;
      background: linear-gradient(135deg, #0f0f0f 0%, #1a1a2e 100%);
    }

    .nuke-button {
      background: linear-gradient(135deg, #ff1744 0%, #d32f2f 100%);
      box-shadow: 0 0 30px rgba(255, 23, 68, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.2);
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      position: relative;
      overflow: hidden;
    }

    .nuke-button:hover:not(:disabled) {
      transform: scale(1.05);
      box-shadow: 0 0 50px rgba(255, 23, 68, 0.8), inset 0 1px 0 rgba(255, 255, 255, 0.3);
      letter-spacing: 2px;
    }

    .nuke-button:active:not(:disabled) {
      transform: scale(0.98);
    }

    .nuke-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .device-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }

    .device-card:hover {
      border-color: rgba(255, 23, 68, 0.3);
      box-shadow: 0 0 20px rgba(255, 23, 68, 0.1);
    }

    .device-card.selected {
      border-color: #ff1744;
      background: rgba(255, 23, 68, 0.1);
      box-shadow: 0 0 20px rgba(255, 23, 68, 0.3);
    }

    .qr-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .qr-modal {
      background: #1a1a2e;
      border: 2px solid rgba(255, 23, 68, 0.3);
      border-radius: 12px;
      padding: 2rem;
      animation: slideUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes slideUp {
      from { 
        opacity: 0;
        transform: translateY(20px);
      }
      to { 
        opacity: 1;
        transform: translateY(0);
      }
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .status-active {
      background: rgba(76, 175, 80, 0.2);
      color: #4caf50;
      border: 1px solid rgba(76, 175, 80, 0.4);
    }

    .nuke-confirmation {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 60;
      animation: fadeIn 0.3s ease;
    }

    .confirmation-modal {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border: 2px solid #ff1744;
      border-radius: 12px;
      padding: 3rem;
      text-align: center;
      max-width: 400px;
      animation: slideUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .confirmation-modal h2 {
      color: #ff1744;
      font-size: 2rem;
      margin-bottom: 1rem;
      letter-spacing: 2px;
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
  </style>
  <style>body { box-sizing: border-box; }</style>
 </head>
 <body class="h-full">
  <div class="h-full overflow-auto bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950"><!-- Header -->
   <header class="sticky top-0 z-30 border-b border-slate-800 backdrop-blur-xl bg-slate-950/50">
    <div class="max-w-7xl mx-auto px-6 py-4">
     <div class="flex items-center justify-between">
      <div>
       <h1 class="text-3xl font-bold text-white tracking-wider">DEVICE NUKE</h1>
       <p class="text-slate-400 text-sm mt-1">Remote Device Control System</p>
      </div>
      <div class="text-right">
       <div class="text-slate-300 text-sm" id="device-count">
        0 Geräte registriert
       </div>
      </div>
     </div>
    </div>
   </header><!-- Main Content -->
   <main class="max-w-7xl mx-auto px-6 py-8"><!-- Add Device Section -->
    <section class="mb-8"><button id="add-device-btn" class="bg-gradient-to-r from-emerald-600 to-emerald-700 hover:from-emerald-500 hover:to-emerald-600 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg"> + Gerät hinzufügen (QR-Code) </button>
    </section><!-- Device List -->
    <section class="mb-8">
     <h2 class="text-xl font-bold text-white mb-4 tracking-wide">Registrierte Geräte</h2>
     <div id="device-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <div class="device-card p-6 rounded-lg text-center text-slate-400">
       Keine Geräte registriert. Klicke oben auf "+ Gerät hinzufügen" um zu starten.
      </div>
     </div>
    </section><!-- Control Section -->
    <section class="mt-12 p-8 border border-slate-800 rounded-lg bg-slate-950/50 backdrop-blur">
     <h2 class="text-xl font-bold text-white mb-6 tracking-wide">Gerätekontrolle</h2>
     <div class="mb-8"><label class="block text-slate-300 text-sm font-bold mb-3">Zielgerät auswählen:</label>
      <div id="selected-device-info" class="p-4 bg-slate-900 rounded border border-slate-700 text-slate-400">
       Bitte wählen Sie ein Gerät aus der Liste oben aus
      </div>
     </div>
     <div class="flex justify-center"><button id="nuke-button" disabled class="nuke-button text-white font-bold py-4 px-12 rounded-lg text-xl uppercase tracking-widest cursor-not-allowed"> NUKE </button>
     </div>
    </section>
   </main>
  </div><!-- QR Code Modal -->
  <div id="qr-modal" class="hidden qr-overlay">
   <div class="qr-modal">
    <h2 class="text-2xl font-bold text-white mb-6 text-center tracking-wide">Neues Gerät registrieren</h2>
    <div class="mb-6"><label class="block text-slate-300 text-sm font-bold mb-2">Gerätename:</label> <input type="text" id="device-name-input" placeholder="z.B. iPhone 15, Samsung S24..." class="w-full px-4 py-2 bg-slate-800 border border-slate-700 rounded text-white placeholder-slate-500 focus:border-emerald-500 focus:outline-none">
    </div>
    <div class="mb-6 text-center">
     <p class="text-slate-400 text-sm mb-4">QR-Code wird generiert:</p>
     <div id="qr-code" class="bg-white p-4 rounded inline-block"></div>
    </div>
    <div class="flex gap-4"><button id="confirm-device-btn" class="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-4 rounded transition-all duration-300"> Gerät registrieren </button> <button id="close-qr-btn" class="flex-1 bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 px-4 rounded transition-all duration-300"> Abbrechen </button>
    </div>
   </div>
  </div><!-- Nuke Confirmation Modal -->
  <div id="nuke-confirmation" class="hidden nuke-confirmation">
   <div class="confirmation-modal">
    <h2>⚠️ NUKE BESTÄTIGUNG</h2>
    <p class="text-slate-300 mb-6" id="confirmation-device-name">Gerät wird gelöscht...</p>
    <p class="text-slate-400 text-sm mb-8">Diese Aktion löscht alle Daten auf dem Gerät. Dies kann nicht rückgängig gemacht werden!</p>
    <div class="flex gap-4"><button id="confirm-nuke-btn" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded transition-all duration-300 uppercase tracking-wider"> BESTÄTIGEN </button> <button id="cancel-nuke-btn" class="flex-1 bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 px-4 rounded transition-all duration-300"> Abbrechen </button>
    </div>
   </div>
  </div><!-- Success Notification -->
  <div id="nuke-success" class="hidden fixed bottom-8 right-8 bg-green-600 text-white px-6 py-4 rounded-lg shadow-lg z-50 animate-bounce">
   ✓ Gerät erfolgreich gelöscht!
  </div>
  <script>
    let allDevices = [];
    let selectedDeviceId = null;
    let pendingDeviceData = null;

    const dataHandler = {
      onDataChanged(data) {
        allDevices = data;
        renderDeviceList();
        updateDeviceCount();
      }
    };

    async function initializeApp() {
      const initResult = await window.dataSdk.init(dataHandler);
      if (!initResult.isOk) {
        console.error("Failed to initialize Data SDK");
      }
    }

    function renderDeviceList() {
      const deviceList = document.getElementById('device-list');
      
      if (allDevices.length === 0) {
        deviceList.innerHTML = '<div class="device-card p-6 rounded-lg text-center text-slate-400 col-span-full">Keine Geräte registriert. Klicke oben auf "+ Gerät hinzufügen" um zu starten.</div>';
        return;
      }

      deviceList.innerHTML = allDevices.map(device => {
        const isSelected = device.__backendId === selectedDeviceId;
        const registeredDate = new Date(device.registered_at).toLocaleDateString('de-DE');
        
        return `
          <div class="device-card p-6 rounded-lg cursor-pointer ${isSelected ? 'selected' : ''}" onclick="selectDevice('${device.__backendId}', '${device.device_name}')">
            <div class="text-right mb-2">
              <span class="status-badge status-active">AKTIV</span>
            </div>
            <h3 class="text-lg font-bold text-white mb-2">${device.device_name}</h3>
            <div class="text-sm text-slate-400 space-y-1">
              <p>ID: ${device.device_id.substring(0, 12)}...</p>
              <p>Registriert: ${registeredDate}</p>
            </div>
            <div class="mt-4 pt-4 border-t border-slate-700">
              <p class="text-xs text-emerald-400">➤ Zum Löschen auswählen</p>
            </div>
          </div>
        `;
      }).join('');
    }

    function selectDevice(backendId, deviceName) {
      selectedDeviceId = backendId;
      const nukeButton = document.getElementById('nuke-button');
      const selectedInfo = document.getElementById('selected-device-info');
      
      nukeButton.disabled = false;
      selectedInfo.innerHTML = `
        <div class="text-white">
          <p class="font-bold text-lg">${deviceName}</p>
          <p class="text-sm text-slate-400 mt-2">Bereit zum Löschen</p>
        </div>
      `;
      
      renderDeviceList();
    }

    function updateDeviceCount() {
      document.getElementById('device-count').textContent = `${allDevices.length} Gerät${allDevices.length !== 1 ? 'e' : ''} registriert`;
    }

    function generateDeviceId() {
      return 'DEV-' + Math.random().toString(36).substr(2, 9).toUpperCase();
    }

    function showQRModal() {
      const modal = document.getElementById('qr-modal');
      modal.classList.remove('hidden');
      
      const deviceId = generateDeviceId();
      const qrData = JSON.stringify({
        type: 'device_register',
        device_id: deviceId,
        timestamp: new Date().toISOString()
      });

      pendingDeviceData = {
        device_id: deviceId,
        registered_at: new Date().toISOString()
      };

      document.getElementById('qr-code').innerHTML = '';
      QRCode.toCanvas(document.getElementById('qr-code'), qrData, {
        width: 250,
        margin: 2,
        color: { dark: '#0f0f0f', light: '#ffffff' }
      });
    }

    function closeQRModal() {
      document.getElementById('qr-modal').classList.add('hidden');
      document.getElementById('device-name-input').value = '';
      pendingDeviceData = null;
    }

    async function registerDevice() {
      const deviceName = document.getElementById('device-name-input').value.trim();
      
      if (!deviceName) {
        alert('Bitte geben Sie einen Gerätenamen ein');
        return;
      }

      if (!pendingDeviceData) {
        alert('Fehler: Gerätedaten nicht verfügbar');
        return;
      }

      const createResult = await window.dataSdk.create({
        device_id: pendingDeviceData.device_id,
        device_name: deviceName,
        registered_at: pendingDeviceData.registered_at,
        last_seen: new Date().toISOString()
      });

      if (createResult.isOk) {
        closeQRModal();
      } else {
        alert('Fehler beim Registrieren des Geräts');
      }
    }

    async function nukeDevice() {
      if (!selectedDeviceId) return;

      const selectedDevice = allDevices.find(d => d.__backendId === selectedDeviceId);
      if (!selectedDevice) return;

      document.getElementById('confirmation-device-name').textContent = `Gerät "${selectedDevice.device_name}" wird gelöscht...`;
      document.getElementById('nuke-confirmation').classList.remove('hidden');
    }

    async function confirmNuke() {
      if (!selectedDeviceId) return;

      const selectedDevice = allDevices.find(d => d.__backendId === selectedDeviceId);
      if (!selectedDevice) return;

      document.getElementById('nuke-confirmation').classList.add('hidden');
      document.getElementById('nuke-button').disabled = true;

      // HTTP-Anfrage an deinen Server senden
      try {
        const response = await fetch('YOUR_SERVER_URL/api/nuke', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            device_id: selectedDevice.device_id,
            device_name: selectedDevice.device_name,
            timestamp: new Date().toISOString()
          })
        });

        if (response.ok) {
          const data = await response.json();
          console.log('Server response:', data);
          
          // Gerät aus der Liste löschen (optional)
          const deleteResult = await window.dataSdk.delete(selectedDevice);
          
          if (deleteResult.isOk) {
            showNukeSuccess();
            selectedDeviceId = null;
            document.getElementById('selected-device-info').innerHTML = 'Bitte wählen Sie ein Gerät aus der Liste oben aus';
          }
        } else {
          showNukeError(`Server-Fehler: ${response.status}`);
          document.getElementById('nuke-button').disabled = false;
        }
      } catch (error) {
        console.error('Fehler beim Senden der HTTP-Anfrage:', error);
        showNukeError('Verbindungsfehler. Überprüfen Sie Ihre Server-URL.');
        document.getElementById('nuke-button').disabled = false;
      }
    }

    function cancelNuke() {
      document.getElementById('nuke-confirmation').classList.add('hidden');
    }

    function showNukeSuccess() {
      const successMsg = document.getElementById('nuke-success');
      successMsg.classList.remove('hidden');
      
      setTimeout(() => {
        successMsg.classList.add('hidden');
      }, 3000);
    }

    function showNukeError(errorMessage) {
      const errorElement = document.createElement('div');
      errorElement.className = 'fixed bottom-8 right-8 bg-red-600 text-white px-6 py-4 rounded-lg shadow-lg z-50';
      errorElement.textContent = `✗ ${errorMessage}`;
      document.body.appendChild(errorElement);
      
      setTimeout(() => {
        errorElement.remove();
      }, 4000);
    }

    // Event Listeners
    document.getElementById('add-device-btn').addEventListener('click', showQRModal);
    document.getElementById('close-qr-btn').addEventListener('click', closeQRModal);
    document.getElementById('confirm-device-btn').addEventListener('click', registerDevice);
    document.getElementById('nuke-button').addEventListener('click', nukeDevice);
    document.getElementById('confirm-nuke-btn').addEventListener('click', confirmNuke);
    document.getElementById('cancel-nuke-btn').addEventListener('click', cancelNuke);

    document.getElementById('device-name-input').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') registerDevice();
    });

    // Initialize
    initializeApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9d1e525a00b46791',t:'MTc3MTc2MTYxMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>